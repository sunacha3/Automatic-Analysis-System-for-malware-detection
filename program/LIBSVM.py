#-*- coding:utf-8 -*-
import sys
sys.path.append('/home/pesuchin/Desktop/libsvm-3.18/python/')
from svm import *
from svmutil import *
import csv

def readfile(filename):
  lines=[line for line in file(filename)]

  # First line is the column titles
  colnames=lines[0].strip().split('\t')[1:]
  rownames=[]
  data=[]
  for line in lines[1:]:
    p=line.strip().split('\t')
    # First column in each row is the rowname
    rownames.append(p[0])
    # The data for this row is the remainder of the row
    data.append([float(x) for x in p[1:]])
  return rownames,colnames,data

def main(feature=0,cross=4):
  if feature == 0:
    c_rownames,c_colnames,c_data = readfile('./../feature/cor_BOW.txt')
    m_rownames,m_colnames,m_data = readfile('./../feature/mal_BOW.txt')
  elif feature == 1:
    c_rownames,c_colnames,c_data = readfile('./../feature/cor_count.txt')
    m_rownames,m_colnames,m_data = readfile('./../feature/mal_count.txt')
  elif feature == 2:
    c_rownames,c_colnames,c_data = readfile('./../feature/cor_tf-idf.txt')
    m_rownames,m_colnames,m_data = readfile('./../feature/mal_tf-idf.txt')
  elif feature == 3:
    c_rownames,c_colnames,c_data = readfile('./../feature/cor_prefix.txt')
    m_rownames,m_colnames,m_data = readfile('./../feature/mal_prefix.txt')
  label = []
  #test_data = []
  #test_label = []
  data=[]
  print "Learning SVM started!"
  for i in c_data:
    label.append(1)
  for d in m_data:
    c_data.append(d)
    label.append(-1)
  f = open("./../result/AUC.csv",'a')
  save = csv.writer(f)
  kernel=[""]
  auc=[""]
  kernel.append("Linear")
  kernel.append("Polynomial")
  kernel.append("RBF")
  kernel.append("Sigmoid") 
  save.writerow(kernel)
  print "------------------------------------------------"
  print "Linear kernel"
  print "------------------------------------------------"
  prob = svm_problem(label,c_data) # データとラベルを合成
  param = svm_parameter('-s 0 -t 0 -v %d' % cross) # 学習方法の設定
  m = svm_train(prob, param)
  auc.append(m)
  #result = svm_predict(test_label,test_data,m)
  print "------------------------------------------------"
  print "Polynomial kernel"
  print "------------------------------------------------"
  param = svm_parameter('-s 0 -t 1 -v %d' % cross) # 学習方法の設定
  m = svm_train(prob, param)
  auc.append(m)
  #result = svm_predict(test_label,test_data,m)
  print "------------------------------------------------"
  print "Radial Basis Function(RBF) kernel"
  print "------------------------------------------------"
  param = svm_parameter('-s 0 -t 2 -v %d' % cross) # 学習方法の設定
  m = svm_train(prob, param)
  auc.append(m)
  #result = svm_predict(test_label,test_data,m)
  print "------------------------------------------------"
  print "Sigmoid kernel"
  print "------------------------------------------------"
  param = svm_parameter('-s 0 -t 3 -v %d' % cross) # 学習方法の設定
  m = svm_train(prob, param)
  auc.append(m)
  #result = svm_predict(test_label,test_data,m)
  save.writerow(auc)
  f.close()
  #svm_save_model('test.model',m)
