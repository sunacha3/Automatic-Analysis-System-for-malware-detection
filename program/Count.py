import sys
import os
import api

def init(worddict):
  for k in worddict.keys():
    k = k.rstrip()
    worddict[k]=0
  return worddict

def write_word(worddict,cor_dir,cdirs,out_file,first,level):
  out=open('./../feature/'+out_file,'w')
  for cdir in cdirs:
    cfiles = os.listdir(cor_dir+cdir)
    for file in cfiles:
      if file.endswith('.txt'):
        if file[-5] == str(level):
          f=open(cor_dir+cdir+'/'+file,"r")
          print file
          for word in f:
            word = word.rstrip()
            word = word.replace("\"","")
            worddict[word]+=1
          if first==False:
            out.write('Api')
          #print worddict
            for k in worddict.keys():
              out.write('\t%s' % k)
            out.write('\n')
          first = True
          out.write(file[:-11])
  #      print file[:-11]
          for v in worddict.values():
            out.write('\t%d' % v)
          out.write('\n')
          worddict = init(worddict)
          f.close()
  out.close()


def main(level=0,ngram=0):
  worddict = {}
  dic_filepath = "./../dictionary/dic.csv"
  if ngram == 1:
    cor_dir="./../n-gram/cor/"
    mal_dir = "./../n-gram/mal/"
  elif ngram == 0:
    cor_dir="./../correct_data/"
    mal_dir = "./../malware_data/"
  cdirs = api.getdirs(cor_dir)
  mdirs = api.getdirs(mal_dir)
  first = False
  for line in open(dic_filepath,'r'):
    record = line[:-1].split(',')
    record[0] = record[0].replace("\"","")
    #print record[0]
    worddict[record[0]]=0
#count words
  write_word(worddict,cor_dir,cdirs,'cor_count.txt',first,level)
  write_word(worddict,mal_dir,mdirs,'mal_count.txt',first,level)

