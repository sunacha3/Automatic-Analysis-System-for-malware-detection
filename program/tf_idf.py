from numpy import *

def main():
  cfilename = "./../feature/cor_count.txt"
  mfilename = "./../feature/mal_count.txt"

  lines=[line for line in file(cfilename)]
  
# First line is the column titles
# import correct
  colnames=lines[0].strip().split('\t')[1:]
  rownames=[]
  data=[]
  for line in lines[1:]:
    p=line.strip().split('\t')
    # First column in each row is the rowname
    rownames.append(p[0])
    # The data for this row is the remainder of the row
    data.append([float(x) for x in p[1:]])

  collen=len(colnames)
  rowlen=len(rownames)

  lines2=[line for line in file(mfilename)]

# First line is the column titles
# import malware
  colnames2=lines2[0].strip().split('\t')[1:]
  rownames2=[]
  data2=[]
  for line in lines2[1:]:
    p2=line.strip().split('\t')
  # First column in each row is the rowname
    rownames2.append(p2[0])
  # The data for this row is the remainder of the row
    data2.append([float(x) for x in p2[1:]])

# combine correct with malware
  colnames.extend(colnames2)
  rownames.extend(rownames2)
  data.extend(data2)
  tf = zeros(shape(data))
  col_sum = sum(data,axis=1)
  idf = zeros(shape(data)[0])
  N = len(rownames)
  row_sum=[]
  count = 0
  for i in range(shape(data)[0]):
    for j in range(shape(data)[1]):
      if data[i][j] > 0:
        count += 1
      #print "rowsum[%d]=%d"%(i,count)
    row_sum.append(count)
    count = 0  
  for i in range(shape(data)[0]):
    for j in range(shape(data)[1]):
#tf
    #if i == 344:
    #  print "data=%d" % data[i][j]
    #print "data[%d][%d]/col_sum[%d]=%f" %(i,j,j,data[i][j]*1.0/col_sum[i])
    #  print "col_sum=%f" % col_sum[j]
      if int(data[i][j]) != 0 and int(col_sum[i]) != 0:
        tf[i,j] = double(data[i][j]) / double(col_sum[i])
      else:
        tf[i,j] = 0.0
    #if float(data[i][j]*1.0/col_sum[i]) != float(data[i][j]*1.0/col_sum[i]):
    #  print "data[%d][%d]/col_sum[%d]=%f" %(i,j,j,tf[i][j])
#idf
  for i in range(shape(data)[0]):
  #print "%f / %f = %f" % (N,row_sum[i],N/row_sum[i])
    idf[i] = log(double(N) / double(row_sum[i])) + 1 #idf
#print tf
#print idf
#tf-idf
  out = open('./../feature/cor_tf-idf.txt','w')
  out.write('Api')
  for i in range(collen):
    out.write('\t%s' % colnames[i])
  out.write('\n')
  tf_idf = zeros(shape(data))
  for i in range(rowlen):
    out.write(rownames[i])
    for j in range(collen):    
      tf_idf[i,j] = tf[i,j] * idf[i]
      out.write('\t%f' % tf_idf[i,j])
    out.write('\n')
#print tf_idf

  out2 = open('./../feature/mal_tf-idf.txt','w')
  out2.write('Api')
  for i in range(len(colnames)):
    out2.write('\t%s' % colnames[i])
  out2.write('\n')
  tf_idf = zeros(shape(data))
  for i in range(shape(tf)[0]):
    if i > rowlen:
      out2.write(rownames[i])
      for j in range(shape(tf)[1]):   
        tf_idf[i,j] = tf[i,j] * idf[i]
        out2.write('\t%f' % tf_idf[i,j])
      out2.write('\n')
