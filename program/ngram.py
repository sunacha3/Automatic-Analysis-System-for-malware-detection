import re
import os
import api
def n_gram(level,filepath,n,folder,dir):
  f=open(filepath).read()
  api = f.split("\n")
  gram = []
  number = re.findall(r"[0-9]+",filepath)
  api.remove("")
  for l in range(len(api)):
    if l < len(api)-int(n)+1:
      if n==str(2):
        gram.append(api[l]+"::"+api[l+1])
      elif n==str(3):
        gram.append(api[l]+"::"+api[l+1]+"::"+api[l+2])
      elif n==str(4):
        gram.append(api[l]+"::"+api[l+1]+"::"+api[l+2]+"::"+api[l+3])
      elif n==str(5):
        gram.append(api[l]+"::"+api[l+1]+"::"+api[l+2]+"::"+api[l+3]+"::"+api[l+4])
  if folder == True:
    out=open("./../n-gram/cor/"+dir+"/n_gram"+number[0]+"_level"+number[1]+".txt","w")
    for w in gram:
      out.write(w+"\n")
  else:
    out=open("./../n-gram/mal/"+dir+"/n_gram"+number[0]+"_level"+number[1]+".txt","w")
    for w in gram:
      out.write(w+"\n")
  out.close()
  print "report%d,complete!"% int(number[0])
     #word = word.rstrip()

def main(level=0,n=2):
  cor_dir="./../correct_data/"
  mal_dir = "./../malware_data/"
  
  cdirs = api.getdirs(cor_dir)
  mdirs = api.getdirs(mal_dir)
  folder = True
  for dir in cdirs:
    cfiles = os.listdir(cor_dir+dir)
    for filename in cfiles:
      if filename.endswith('.txt'):
        filepath = cor_dir +dir+'/'+ filename
        n_gram(level,filepath,str(n),folder,dir)
  folder = False
  for dir in mdirs:
    mfiles = os.listdir(mal_dir+dir)
    for filename in mfiles:
      if filename.endswith('txt'):
        filepath = mal_dir+dir+'/'+ filename
        n_gram(level,filepath,str(n),folder,dir)
